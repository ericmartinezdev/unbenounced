{{ 'component-slick-slider.css' | asset_url | stylesheet_tag }}

<div class="slick">
  <div class="row">
    {% for product in section.settings.collection.products %}
      <div class="slide">
        <a href="{{ product.url }}" class="slide__a" draggable="false">
          <img draggable="false" src="{{ product.featured_image | image_url }}">
          <span class="slide__button color-{{ section.settings.color_scheme }} {% if section.settings.transparent_button %}transparent-background{% endif %}">{{ section.settings.button__text }}</span>
        </a>
      </div>
    {% endfor %}
  </div>
</div>


<script>
  const slider = document.getElementsByClassName('slick')[0]
  let isDown = false;
  let startX;
  let scrollLeft; // slick element distance from left (margin-left ?)
  let isMove = false;
  
  // Click event
  slider.addEventListener('click', cancelClick);

  // Mouse events
  slider.addEventListener('mousedown', dragStart);
  slider.addEventListener('mousemove', dragAction);
  slider.addEventListener('mouseup', dragEnd);
  slider.addEventListener('mouseleave', dragEnd);

  // Touch events
  slider.addEventListener('touchstart', dragStart);
  slider.addEventListener('touchmove', dragAction);
  slider.addEventListener('touchend', dragEnd);

  // fn's for behavior
  function dragStart(e) {
    isDown = true;
    startX = e.pageX - slider.offsetLeft;
    scrollLeft = slider.scrollLeft;
    cancelMomentumTracking();
  }

  function dragAction(e) {
    if(!isDown) return; // stop the fn from running
    isMove = true;
    const x = e.pageX - slider.offsetLeft; 
    const walk = (x - startX);
    let prevScrollLeft = slider.scrollLeft;
    slider.scrollLeft = scrollLeft - walk;
    velX = slider.scrollLeft - prevScrollLeft;
  }

  function dragEnd(e) {
    isDown = false;
    beginMomentumTracking();
  }

  function cancelClick(e) {
    if (isMove) {
      e.preventDefault();
    }
    isMove = false;
  }

  
  // Momentum
  let velX = 0;
  let momentumID;

  function beginMomentumTracking() {
    momentumID = requestAnimationFrame(momentumLoop);
  }

  function momentumLoop() {
    slider.scrollLeft += velX * 2;
    velX *= 0.95;
    if (Math.abs(velX) > 0.7) {
      momentumID = requestAnimationFrame(momentumLoop);
    }
  }

  function cancelMomentumTracking() {
    cancelAnimationFrame(momentumID);
  }

  // Scroll
  slider.addEventListener('wheel',(e) => {
    window.requestAnimationFrame(() => {
      slider.scrollTo({top: 0, left: slider.scrollLeft + (e.deltaX * 2), bahavior: "smooth"});
    });
  });
</script>

{% schema %}
  {
    "name": "Slick Slider",
    "settings": [
      {
        "type": "color_scheme",
        "id": "color_scheme",
        "label": "Color Scheme",
        "default": "accent-1"
      },
      {
        "type": "checkbox",
        "id": "transparent_button",
        "label": "Transparent Button Background",
        "default": false
      },
      {
        "type": "collection",
        "id": "collection",
        "label": "Collection"
      }, 
      {
        "type": "text",
        "id": "button__text",
        "label": "Button Label",
        "default": "Shop"
      }
    ],
    "presets": [
      {
        "name": "Slick Slider" 
      }
    ]
  }
{% endschema %}